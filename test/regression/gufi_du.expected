#####################################
# Run gufi_du without treesummary data

# du blocks on sparse files
$ gufi_du prefix | sort -k 2,2
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?

$ gufi_du --block-size 1 prefix | sort -k 2
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?

$ gufi_du --block-size 1 --total prefix | sort -k 2
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 total

$ gufi_du --block-size 1 --summarize prefix
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 prefix

$ gufi_du --block-size 1 --total --summarize prefix
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 prefix
0 total

$ gufi_du --block-size 1 --total --summarize --verbose prefix
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -T 'SELECT level(), isroot, treesummary.totblocks, rpath(sname, sroll) FROM treesummary LEFT JOIN vrsummary ON treesummary.inode == vrsummary.inode WHERE vrsummary.isroot == 1;' \
    prefix
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 prefix
0 total

# du sizes
$ gufi_du --apparent-size prefix | sort -k 2
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?

$ gufi_du --apparent-size --block-size 1 prefix | sort -k 2
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?

$ gufi_du --apparent-size --block-size 1 --total prefix | sort -k 2
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 total

$ gufi_du --apparent-size --block-size 1 --summarize prefix
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 prefix

$ gufi_du --apparent-size --block-size 1 --total --summarize prefix
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 prefix
0 total

$ gufi_du --apparent-size --block-size 1 --total --summarize --verbose prefix
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -T 'SELECT level(), isroot, treesummary.totsize, rpath(sname, sroll) FROM treesummary LEFT JOIN vrsummary ON treesummary.inode == vrsummary.inode WHERE vrsummary.isroot == 1;' \
    prefix
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 prefix
0 total

#####################################

#####################################
# Generate treesummary in only one directory

$ gufi_treesummary prefix/directory
totals:
totfiles 4 totlinks 1
totsize 11
minsize 1 maxsize 5
totzero 0 totltk 4 totmtk 0 totltm 4 totmtm 0 totmtg 0 totmtt 0
minmtime 1 maxmtime 5
minatime 1 maxatime 5
minblocks 0 maxblocks 0
totxattr 0
mincrtime 0 maxcrtime 0
minossint1 0 maxossint1 0 totossint1 0
minossint2 0 maxossint2 0 totossint2 0
minossint3 0 maxossint3 0 totossint3 0
minossint4 0 maxossint4 0 totossint4 0
totsubdirs 1 maxsubdirfiles 3 maxsubdirlinks 1 maxsubdirsize 6
totextdbs 0

# Run gufi_du on that the single directory that has treesummary data (success)
$ gufi_du --apparent-size --block-size 1 prefix/directory
11 prefix/directory

# Run gufi_du on the parent directory (only prints size of path with treesummary data)
$ gufi_du --apparent-size --block-size 1 prefix
11 prefix/directory

# Summarize the subtree starting at the parent (fails)
$ gufi_du --apparent-size --block-size 1 --summarize prefix
Warning: Did not get any results from gufi_query.
Does "prefix" have treesummary data?
0 prefix

#####################################

#####################################
# Generate treesummary in all directories

$ gufi_treesummary_all search

# du blocks on sparse files
$ gufi_du prefix | sort -k 2,2
8 prefix
0 prefix/directory
0 prefix/directory/subdirectory
0 prefix/empty_directory
8 prefix/leaf_directory
0 prefix/unusual#? directory ,

$ gufi_du --block-size 1 prefix | sort -k 2
8192 prefix
0 prefix/directory
0 prefix/directory/subdirectory
0 prefix/empty_directory
8192 prefix/leaf_directory
0 prefix/unusual#? directory ,

$ gufi_du --block-size 1 --total prefix | sort -k 2
8192 prefix
0 prefix/directory
0 prefix/directory/subdirectory
0 prefix/empty_directory
8192 prefix/leaf_directory
0 prefix/unusual#? directory ,
8192 total

$ gufi_du --block-size 1 --summarize prefix
8192 prefix

$ gufi_du --block-size 1 --total --summarize prefix
8192 prefix
8192 total

$ gufi_du --block-size 1 --total --summarize --verbose prefix
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -T 'SELECT level(), isroot, treesummary.totblocks, rpath(sname, sroll) FROM treesummary LEFT JOIN vrsummary ON treesummary.inode == vrsummary.inode WHERE vrsummary.isroot == 1;' \
    prefix
8192 prefix
8192 total

# du sizes
$ gufi_du --apparent-size prefix | sort -k 2
1026 prefix
1 prefix/directory
1 prefix/directory/subdirectory
0 prefix/empty_directory
1 prefix/leaf_directory
1 prefix/unusual#? directory ,

$ gufi_du --apparent-size --block-size 1 prefix | sort -k 2
1049673 prefix
11 prefix/directory
5 prefix/directory/subdirectory
0 prefix/empty_directory
23 prefix/leaf_directory
15 prefix/unusual#? directory ,

$ gufi_du --apparent-size --block-size 1 --total prefix | sort -k 2
1049673 prefix
11 prefix/directory
5 prefix/directory/subdirectory
0 prefix/empty_directory
23 prefix/leaf_directory
15 prefix/unusual#? directory ,
1049673 total

$ gufi_du --apparent-size --block-size 1 --summarize prefix
1049673 prefix

$ gufi_du --apparent-size --block-size 1 --total --summarize prefix
1049673 prefix
1049673 total

$ gufi_du --apparent-size --block-size 1 --total --summarize --verbose prefix
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -T 'SELECT level(), isroot, treesummary.totsize, rpath(sname, sroll) FROM treesummary LEFT JOIN vrsummary ON treesummary.inode == vrsummary.inode WHERE vrsummary.isroot == 1;' \
    prefix
1049673 prefix
1049673 total
#####################################

#####################################
# Run gufi_du from rolled up tree

$ gufi_rollup "search" > /dev/null 2>&1

# du blocks on sparse files
$ gufi_du prefix | sort -k 2,2
8 prefix
0 prefix/directory
0 prefix/directory/subdirectory
0 prefix/empty_directory
8 prefix/leaf_directory
0 prefix/unusual#? directory ,

$ gufi_du --block-size 1 prefix | sort -k 2
8192 prefix
0 prefix/directory
0 prefix/directory/subdirectory
0 prefix/empty_directory
8192 prefix/leaf_directory
0 prefix/unusual#? directory ,

$ gufi_du --block-size 1 --total prefix | sort -k 2
8192 prefix
0 prefix/directory
0 prefix/directory/subdirectory
0 prefix/empty_directory
8192 prefix/leaf_directory
0 prefix/unusual#? directory ,
8192 total

$ gufi_du --block-size 1 --summarize prefix
8192 prefix

$ gufi_du --block-size 1 --total --summarize prefix
8192 prefix
8192 total

$ gufi_du --block-size 1 --total --summarize --verbose prefix
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -T 'SELECT level(), isroot, treesummary.totblocks, rpath(sname, sroll) FROM treesummary LEFT JOIN vrsummary ON treesummary.inode == vrsummary.inode WHERE vrsummary.isroot == 1;' \
    prefix
8192 prefix
8192 total

# du sizes
$ gufi_du --apparent-size prefix | sort -k 2
1026 prefix
1 prefix/directory
1 prefix/directory/subdirectory
0 prefix/empty_directory
1 prefix/leaf_directory
1 prefix/unusual#? directory ,

$ gufi_du --apparent-size --block-size 1 prefix | sort -k 2
1049673 prefix
11 prefix/directory
5 prefix/directory/subdirectory
0 prefix/empty_directory
23 prefix/leaf_directory
15 prefix/unusual#? directory ,

$ gufi_du --apparent-size --block-size 1 --total prefix | sort -k 2
1049673 prefix
11 prefix/directory
5 prefix/directory/subdirectory
0 prefix/empty_directory
23 prefix/leaf_directory
15 prefix/unusual#? directory ,
1049673 total

$ gufi_du --apparent-size --block-size 1 --summarize prefix
1049673 prefix

$ gufi_du --apparent-size --block-size 1 --total --summarize prefix
1049673 prefix
1049673 total

$ gufi_du --apparent-size --block-size 1 --total --summarize --verbose prefix
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -T 'SELECT level(), isroot, treesummary.totsize, rpath(sname, sroll) FROM treesummary LEFT JOIN vrsummary ON treesummary.inode == vrsummary.inode WHERE vrsummary.isroot == 1;' \
    prefix
1049673 prefix
1049673 total
#####################################

# Compare treesummary and rollup results

# Run gufi_du on a file path
# du blocks on sparse files
$ gufi_du prefix/1MB prefix/1KB | sort -k 2,2
0 prefix/1KB
0 prefix/1MB

$ gufi_du --block-size 1 prefix/1MB prefix/1KB | sort -k 2
0 prefix/1KB
0 prefix/1MB

$ gufi_du --block-size 1 --total prefix/1MB prefix/1KB | sort -k 2
0 prefix/1KB
0 prefix/1MB
0 total

$ gufi_du --block-size 1 --summarize prefix/1MB prefix/1KB
0 prefix/1MB
0 prefix/1KB

$ gufi_du --block-size 1 --total --summarize prefix/1MB prefix/1KB
0 prefix/1MB
0 prefix/1KB
0 total

$ gufi_du --block-size 1 --total --summarize --verbose prefix/1MB prefix/1KB
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -E 'SELECT level(), 1, blocks, rpath(sname, sroll) || '"'"'/'"'"' || name FROM vrpentries WHERE name == '"'"'1MB'"'"';' \
    prefix
0 prefix/1MB
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -E 'SELECT level(), 1, blocks, rpath(sname, sroll) || '"'"'/'"'"' || name FROM vrpentries WHERE name == '"'"'1KB'"'"';' \
    prefix
0 prefix/1KB
0 total

# du sizes
$ gufi_du --apparent-size prefix/1MB prefix/1KB | sort -k 2
1 prefix/1KB
1024 prefix/1MB

$ gufi_du --apparent-size --block-size 1 prefix/1MB prefix/1KB | sort -k 2
1024 prefix/1KB
1048576 prefix/1MB

$ gufi_du --apparent-size --block-size 1 --total prefix/1MB prefix/1KB | sort -k 2
1024 prefix/1KB
1048576 prefix/1MB
1049600 total

$ gufi_du --apparent-size --block-size 1 --summarize prefix/1MB prefix/1KB
1048576 prefix/1MB
1024 prefix/1KB

$ gufi_du --apparent-size --block-size 1 --total --summarize prefix/1MB prefix/1KB
1048576 prefix/1MB
1024 prefix/1KB
1049600 total

$ gufi_du --apparent-size --block-size 1 --total --summarize --verbose prefix/1MB prefix/1KB
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -E 'SELECT level(), 1, size, rpath(sname, sroll) || '"'"'/'"'"' || name FROM vrpentries WHERE name == '"'"'1MB'"'"';' \
    prefix
1048576 prefix/1MB
GUFI query is
   gufi_query \
    -d ' ' \
    -n 1 \
    -y 0 \
    -z 0 \
    -E 'SELECT level(), 1, size, rpath(sname, sroll) || '"'"'/'"'"' || name FROM vrpentries WHERE name == '"'"'1KB'"'"';' \
    prefix
1024 prefix/1KB
1049600 total

